---
title: "Object Transport Analysis"
author: "Shanaa Modchalingam"
date: '2023'
output: 
  html_notebook:
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    
---

```{r setup, include=FALSE, warning=FALSE}
rm(list = ls()) # clean environment

source("../src/helper_funcs.R")
library(data.table)
library(tidyverse)
library(future) # for parallel processing
library(collections)
library(ggbeeswarm)

library(ez) # for ANOVAs
library(effectsize) # for eta-squared
library(BayesFactor)
library(bayestestR)

library(Reach) # from github: thartbm/Reach
library(dabestr)

# Helper functions
##### Helper functions #####
slope <- function(x, y) {
  return(cov(x, y) / var(x))
}

intercept <- function(x, y, slope) {
  b <- mean(y) - (slope * mean(x))
  return(b)
}

# settings
save_plots = FALSE
```

## Data Import and Summaries
```{r}
# import data
data_path <- "../data/preprocessed/omnibus/omnibus_bl_corrected.csv"

all_data <- fread(data_path)

## Setup ##
palette <- dict(
  list(
    "cube" = "#6aafd2",
    "sphere" = "#f07c04"
  )
)
# make any and all summary dfs here
by_trial_df <- all_data %>%
  group_by(exp, type, trial_num) %>%
  summarise(
    mean_obj_angle_3cm_move = mean(obj_angle_3cm_move),
    ci_obj_angle_3cm_move = vector_confint(obj_angle_3cm_move),
    mean_obj_time_start_move = mean(obj_time_start_move),
    ci_obj_time_start_move = vector_confint(obj_time_start_move),
    mean_obj_time_reach = mean(obj_time_reach),
    ci_obj_time_reach = vector_confint(obj_time_reach),
    mean_obj_time_total_move = mean(obj_time_total_move),
    ci_obj_time_total_move = vector_confint(obj_time_total_move),
    mean_hand_angle_3cm_move = mean(hand_angle_3cm_move),
    ci_hand_angle_3cm_move = vector_confint(hand_angle_3cm_move),
    mean_hand_time_start_move = mean(hand_time_start_move),
    ci_hand_time_start_move = vector_confint(hand_time_start_move),
    mean_hand_time_reach = mean(hand_time_reach),
    ci_hand_time_reach = vector_confint(hand_time_reach),
    mean_hand_time_total_move = mean(hand_time_total_move),
    ci_hand_time_total_move = vector_confint(hand_time_total_move),
  )


## Isolate experiments and summarize ##
sr_30_all <- all_data %>%
  filter(exp == "sr_30") %>%
  mutate(unsigned_angle = obj_angle_3cm_move * obj_shape_sign * -1)

sr_30_ppt_training <- sr_30_all %>%
  filter(block_num == 16) %>%
  mutate(trial_set = case_when(
    trial_num <= 141 ~ 1,
    trial_num >= 316 ~ 2,
    TRUE ~ 100
  ))

sr_30_clamped <- sr_30_all %>%
  filter(block_num > 16, type == "clamped") %>%
  mutate(trained_obj_factor = case_when(
    trainedfirst_obj_shape == obj_shape ~ "trained_obj",
    TRUE ~ "untrained_obj"
  )) %>%
  mutate(trained_hand_factor = case_when(
    hand == "r" ~ "trained_hand",
    TRUE ~ "untrained_hand"
  )) %>%
  mutate(trained_obj_hand_factor = paste0(trained_obj_factor, "_", trained_hand_factor))

### DR 30 ###
dr_30_all <- all_data %>%
  filter(exp == "dr_30") %>%
  mutate(unsigned_angle = obj_angle_3cm_move * obj_shape_sign * -1)

dr_30_ppt_training <- dr_30_all %>%
  filter(block_num == 7) %>%
  mutate(trial_set = case_when(
    trial_num <= 78 ~ 1,
    trial_num >= 253 ~ 2,
    TRUE ~ 100
  ))

# note: blocks 8 and 11 are include clamps, 13 is exclude clamps
dr_30_incl_clamp <- dr_30_all %>%
  filter(block_num %in% c(8, 11))

dr_30_excl_clamp <- dr_30_all %>%
  filter(block_num %in% c(13, 14))

# load in both_ppt_trainng
both_ppt_training <- fread("../data/misc/both_ppt_training.csv")

# # both experiment rbind
# both_ppt_training <- rbind(sr_30_ppt_training, dr_30_ppt_training)
# 
# both_ppt_training <- both_ppt_training %>%
#   group_by(ppid) %>%
#   mutate(
#     learning_rate = Reach::exponentialFit(unsigned_angle)[1],
#     asymptote = Reach::exponentialFit(unsigned_angle)[2]
#   )
# 
# both_ppt_training <- both_ppt_training %>%
#   group_by(ppid, exp) %>%
#   summarise(
#     ppt_learning_rate = first(learning_rate),
#     ppt_asymptote = first(asymptote)
#   )
# 
# # save the above as a csv
# fwrite(both_ppt_training, "../data/misc/both_ppt_training.csv")
```
# S30 Training per-trial plot
```{r}
sr_30_exp_training <- sr_30_ppt_training %>%
  group_by(trial_num) %>% # note: only one where don't need to group_by ppid
  summarise(
    mean_unsigned_angle = mean(unsigned_angle),
    ci_unsigned_angle = vector_confint(unsigned_angle)
  )

data <- sr_30_exp_training

# set up plot
p <- data %>%
  ggplot(
    aes(
      x = trial_num - 138, y = mean_unsigned_angle
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = "Trial Number",
    y = "Hand Angle (°)"
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add a grey box behind trial sets
p <- p +
  geom_rect(
    xmin = 1, xmax = 3,
    ymin = -5, ymax = 35,
    colour = "#CCCCCC", fill = "#CCCCCC"
  ) +
  geom_rect(
    xmin = 178, xmax = 180,
    ymin = -5, ymax = 35,
    colour = "#CCCCCC", fill = "#CCCCCC"
  )

p <- p +
  scale_y_continuous(
    limits = c(-5, 35),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  ) +
  scale_x_continuous(
    limits = c(0, 180),
    breaks = c(0, 60, 120, 180),
    labels = c(0, 60, 120, 180)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add confidence intervals
p <- p + geom_ribbon(
  aes(
    ymin = mean_unsigned_angle - ci_unsigned_angle,
    ymax = mean_unsigned_angle + ci_unsigned_angle
  ),
  fill = "#6aafd2", colour = NA, alpha = 0.3
)

# add data
p <- p + geom_line(colour = "#6aafd2")


# save
if (save_plots) {
  ggsave(
  p,
  filename = "../plots/paper_figs/sr_30_training.pdf", device = "pdf",
  height = 4, width = 6
  )
  }

p
```
# S30 Training trial set plot
```{r}
sr_30_ppt_trial_sets <- sr_30_ppt_training %>%
  filter(trial_set < 5) %>%
  group_by(ppid, trial_set) %>%
  summarise(
    mean_trial_set_angle = mean(unsigned_angle)
  )

sr_30_ppt_trial_sets$trial_set <- as.factor(sr_30_ppt_trial_sets$trial_set)

sr_30_trial_set_devs <- sr_30_ppt_trial_sets %>%
  group_by(trial_set) %>%
  summarise(
    trial_set_mean = mean(mean_trial_set_angle),
    trial_set_ci = vector_confint(mean_trial_set_angle)
  )

data_ppt <- sr_30_ppt_trial_sets
data_trial_set <- sr_30_trial_set_devs

# set up plot
p <- data_trial_set %>%
  ggplot(
    aes(
      x = trial_set, y = trial_set_mean,
      color = trial_set
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = NULL,
    y = NULL
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add axis ticks
p <- p +
  scale_y_continuous(
    limits = c(-15, 40),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(y = mean_trial_set_angle),
    alpha = 0.1,
    size = 1
  ) +
  geom_linerange(aes(
    ymin = trial_set_mean - trial_set_ci,
    ymax = trial_set_mean + trial_set_ci
  ), alpha = 0.5, lwd = 2)

p <- p +
  scale_color_manual(
    values = c(
      "#f07c04", "#a30f15"
    )
  )

p <- p +
  scale_x_discrete(
    labels = c(
      "Init\nT", "Fin\nT"
    )
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/sr_30_trial_set.pdf", device = "pdf",
    height = 4, width = 2
  )
}
  
p
```
### Single Rotation Training Analysis

```{r}
# summary statistics
data_ppt %>% 
  group_by(trial_set) %>% 
  summarise(
    mean = mean(mean_trial_set_angle),
    ci = vector_confint(mean_trial_set_angle),
    n = n()
  )
```

For Bayes Factors, we perform the “JZS” t test described by Rouder, Speckman, Sun, Morey, and Iverson (2009)

```{r}
# sample size is >30, no need to test for normality
# Note: one sample t-test on the differences is EQUIVALENT to a paired t-test

# Comparison stats
# paired t-test
group1 <- data_ppt %>% 
  filter(trial_set == "1") %>% 
  pull(mean_trial_set_angle)

group2 <- data_ppt %>%
  filter(trial_set == "2") %>% 
  pull(mean_trial_set_angle)

diffs <- group2 - group1

t.test(diffs)

# Effect size
cohen.d(group1, group2)

# Bayes Factor
bf <- ttestBF(x = diffs)
bf
```
The BF for alternative vs null is 219463158191



```{r}
trialset_paired <- 
  data_ppt %>%
  dabest(trial_set, mean_trial_set_angle, 
         idx = c("1", "2"), 
         paired = TRUE, id.col = ppid)

p <- trialset_paired %>% 
  mean_diff() %>% 
  plot()

p
```


# S30 Clamped
```{r}
sr_30_ppt_clamped <- sr_30_clamped %>%
  group_by(ppid, trained_obj_hand_factor, trained_obj_factor, trained_hand_factor) %>%
  summarise(
    ppt_mean_unsigned_angle = mean(unsigned_angle),
    ci_unsigned_angle = vector_confint(unsigned_angle)
  ) %>%
  mutate(fixed_angle = case_when(
    (trained_obj_hand_factor == "untrained_obj_trained_hand") |
      (trained_obj_hand_factor == "untrained_obj_untrained_hand") ~ ppt_mean_unsigned_angle * -1,
    TRUE ~ ppt_mean_unsigned_angle
  ))

sr_30_ppt_clamped$trained_obj_hand_factor <- factor(sr_30_ppt_clamped$trained_obj_hand_factor)
sr_30_ppt_clamped$trained_obj_factor <- factor(sr_30_ppt_clamped$trained_obj_factor)
sr_30_ppt_clamped$trained_hand_factor <- factor(sr_30_ppt_clamped$trained_hand_factor)

sr_30_obj_hand_clamped <- sr_30_ppt_clamped %>%
  group_by(trained_obj_hand_factor) %>%
  summarise(
    mean_unsigned_angle = mean(fixed_angle),
    ci_unsigned_angle = vector_confint(fixed_angle)
  )
data_ppt <- sr_30_ppt_clamped
data_obj_hand_factor <- sr_30_obj_hand_clamped

# set up plot
p <- data_obj_hand_factor %>%
  ggplot(
    aes(
      x = factor(trained_obj_hand_factor,
        levels =
          c(
            "trained_obj_trained_hand", "untrained_obj_trained_hand",
            "trained_obj_untrained_hand", "untrained_obj_untrained_hand"
          )
      ),
      y = mean_unsigned_angle,
      color = trained_obj_hand_factor
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = NULL,
    y = "Hand Angle (°)"
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add axis ticks
p <- p +
  scale_y_continuous(
    limits = c(-15, 40),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(
      x = factor(trained_obj_hand_factor,
        levels =
          c(
            "trained_obj_trained_hand", "untrained_obj_trained_hand",
            "trained_obj_untrained_hand", "untrained_obj_untrained_hand"
          )
      ),
      y = fixed_angle
    ),
    alpha = 0.1,
    size = 1
  ) +
  geom_linerange(aes(
    ymin = mean_unsigned_angle - ci_unsigned_angle,
    ymax = mean_unsigned_angle + ci_unsigned_angle
  ), alpha = 0.5, lwd = 2) +
  geom_point()

p <- p +
  scale_color_manual(
    values = c(
      "#f07c04", "#a30f15",
      "#f07c04", "#a30f15"
    )
  )

p <- p +
  scale_x_discrete(
    breaks = c(
      "trained_obj_trained_hand", "untrained_obj_trained_hand",
      "trained_obj_untrained_hand", "untrained_obj_untrained_hand"
    ),
    labels = c(
      "Trained Shape \nTrained Hand", "Unrained Shape \nTrained Hand",
      "Trained Shape \nUntrained Hand", "Untrained Shape \nUntrained Hand"
    )
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/sr_30_clamped.pdf", device = "pdf",
    height = 4, width = 4
  )
}

p
```
```{r}
sr_30_ppt_clamped %>%
  group_by(trained_obj_hand_factor) %>%
  summarise(
    mean = mean(fixed_angle),
    sd = sd(fixed_angle),
    ci = vector_confint(fixed_angle),
    n = n()
  )
```

```{r}
temp_ANOVA <- aov(fixed_angle ~ trained_obj_factor * trained_hand_factor, data = sr_30_ppt_clamped)

# show ANOVA + assumptions
print(summary(temp_ANOVA), digits = 6)
eta_squared(temp_ANOVA)
TukeyHSD(temp_ANOVA)
```
```{r}
bf <- anovaBF(fixed_angle ~ trained_obj_factor * trained_hand_factor, data = data.frame(sr_30_ppt_clamped), progress = FALSE)
print(bf)
bayesfactor_inclusion(bf)
```


# D30 Training per-trial plot
```{r}
dr_30_exp_training <- dr_30_ppt_training %>%
  group_by(trial_num_in_block) %>%
  summarise(
    mean_unsigned_angle = mean(unsigned_angle),
    ci_unsigned_angle = vector_confint(unsigned_angle)
  )

data <- dr_30_exp_training

# set up plot
p <- data %>%
  ggplot(
    aes(
      x = trial_num_in_block,
      y = mean_unsigned_angle
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = "Trial Number",
    y = "Hand Angle (°)"
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add grey boxes behind trial sets
p <- p +
  geom_rect(
    xmin = 1, xmax = 3,
    ymin = -10, ymax = 15,
    colour = "#CCCCCC", fill = "#CCCCCC"
  ) +
  geom_rect(
    xmin = 178, xmax = 180,
    ymin = -10, ymax = 15,
    colour = "#CCCCCC", fill = "#CCCCCC"
  )

p <- p +
  scale_y_continuous(
    limits = c(-10, 15),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  ) +
  scale_x_continuous(
    limits = c(0, 180),
    breaks = c(0, 60, 120, 180),
    labels = c(0, 60, 120, 180)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add confidence intervals
p <- p + geom_ribbon(
  aes(
    ymin = mean_unsigned_angle - ci_unsigned_angle,
    ymax = mean_unsigned_angle + ci_unsigned_angle
  ),
  fill = "#6aafd2", colour = NA, alpha = 0.3
)

# add data
p <- p + geom_line(colour = "#6aafd2")

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/dr_30_training.pdf", device = "pdf",
    height = 4, width = 6
  )
}

p
```

# DR30 Training trial set plot
```{r}
dr_30_ppt_trial_sets <- dr_30_ppt_training %>%
  filter(trial_set < 5) %>%
  group_by(ppid, trial_set) %>%
  summarise(
    mean_trial_set_angle = mean(unsigned_angle)
  )

dr_30_ppt_trial_sets$trial_set <- as.factor(dr_30_ppt_trial_sets$trial_set)

dr_30_trial_set_devs <- dr_30_ppt_trial_sets %>%
  group_by(trial_set) %>%
  summarise(
    trial_set_mean = mean(mean_trial_set_angle),
    trial_set_ci = vector_confint(mean_trial_set_angle)
  )

data_ppt <- dr_30_ppt_trial_sets
data_trial_set <- dr_30_trial_set_devs

# set up plot
p <- data_trial_set %>%
  ggplot(
    aes(
      x = trial_set, y = trial_set_mean,
      color = trial_set
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = NULL,
    y = "Hand Angle (°)"
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add axis ticks
p <- p +
  scale_y_continuous(
    limits = c(-15, 40),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(y = mean_trial_set_angle),
    alpha = 0.1,
    size = 1
  ) +
  geom_linerange(aes(
    ymin = trial_set_mean - trial_set_ci,
    ymax = trial_set_mean + trial_set_ci
  ), alpha = 0.5, lwd = 2)

p <- p +
  scale_color_manual(
    values = c(
      "#f07c04", "#a30f15"
    )
  )

p <- p +
  scale_x_discrete(
    labels = c(
      "Init", "Fin"
    )
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/dr_30_trial_set.pdf", device = "pdf",
    height = 4, width = 2
  )
}
  
p
```

```{r}
# Comparison stats
# paired t-test
group1 <- data_ppt %>% 
  filter(trial_set == "1") %>% 
  pull(mean_trial_set_angle)

group2 <- data_ppt %>%
  filter(trial_set == "2") %>% 
  pull(mean_trial_set_angle)

diffs <- group2 - group1
t.test(diffs)

# Effect size
cohen.d(group1, group2)

# Bayes factor
ttestBF(x = diffs)
```


```{r}
trialset_paired <- 
  data_ppt %>%
  dabest(trial_set, mean_trial_set_angle, 
         idx = c("1", "2"), 
         paired = TRUE, id.col = ppid)

p <- trialset_paired %>% 
  mean_diff() %>% 
  plot()

p
```

# D30 include strategy clamped plot
```{r}
dr_30_ppt_incl_clamped <- dr_30_incl_clamp %>%
  group_by(ppid, obj_shape_sign) %>%
  summarise(
    ppt_mean_angle = mean(obj_angle_3cm_move),
    ppt_ci_angle = vector_confint(obj_angle_3cm_move)
  )

dr_30_ppt_incl_clamped$obj_shape_sign <- factor(
  dr_30_ppt_incl_clamped$obj_shape_sign
)

dr_30_exp_incl_clamped <- dr_30_ppt_incl_clamped %>%
  group_by(obj_shape_sign) %>%
  summarise(
    mean_angle = mean(ppt_mean_angle),
    ci_angle = vector_confint(ppt_mean_angle)
  )

data_ppt <- dr_30_ppt_incl_clamped
data_exp <- dr_30_exp_incl_clamped

# set up plot
p <- data_exp %>%
  ggplot(
    aes(
      x = obj_shape_sign,
      y = mean_angle,
      color = obj_shape_sign
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = NULL,
    y = NULL
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add axis ticks
p <- p +
  scale_y_continuous(
    # limits = c(-15, 40),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(
      x = obj_shape_sign,
      y = ppt_mean_angle,
      color = obj_shape_sign
    ),
    size = 1,
    alpha = 0.1
  ) +
  geom_linerange(
    aes(
      ymin = mean_angle - ci_angle,
      ymax = mean_angle + ci_angle
    ),
    alpha = 0.5, lwd = 2
  ) +
  geom_point()

p <- p +
  scale_color_manual(
    values = c("#f07c04", "#a30f15")
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/dr_30_incl_clamped.pdf", device = "pdf",
    height = 4, width = 2
  )
}

p
```

```{r}
# Comparison stats
# paired t-test
group1 <- data_ppt %>% 
  filter(obj_shape_sign == "-1") %>% 
  pull(ppt_mean_angle)

group2 <- data_ppt %>%
  filter(obj_shape_sign == "1") %>% 
  pull(ppt_mean_angle)

diffs <- group2 - group1
t.test(diffs)

# Effect size
cohen.d(group1, group2)

# Bayes factor
ttestBF(x = diffs)
```


```{r}
trialset_paired <- 
  data_ppt %>%
  dabest(obj_shape_sign, ppt_mean_angle, 
         idx = c("-1", "1"), 
         paired = TRUE, id.col = ppid)

p <- trialset_paired %>% 
  mean_diff() %>% 
  plot()

p
```

```{r}
dr_30_ppt_incl_clamped %>%
  group_by(obj_shape_sign) %>%
  summarise(
    mean = mean(ppt_mean_angle),
    sd = sd(ppt_mean_angle),
    ci = vector_confint(ppt_mean_angle),
    n = n()
  )
```


# D30 exclude strategy clamped plot
```{r}
dr_30_ppt_excl_clamped <- dr_30_excl_clamp %>%
  group_by(ppid, obj_shape_sign) %>%
  summarise(
    ppt_mean_angle = mean(obj_angle_3cm_move),
    ppt_ci_angle = vector_confint(obj_angle_3cm_move)
  )

dr_30_ppt_excl_clamped$obj_shape_sign <- factor(
  dr_30_ppt_excl_clamped$obj_shape_sign
)

dr_30_exp_excl_clamped <- dr_30_ppt_excl_clamped %>%
  group_by(obj_shape_sign) %>%
  summarise(
    mean_angle = mean(ppt_mean_angle),
    ci_angle = vector_confint(ppt_mean_angle)
  )

data_ppt <- dr_30_ppt_excl_clamped
data_exp <- dr_30_exp_excl_clamped

# set up plot
p <- data_exp %>%
  ggplot(
    aes(
      x = obj_shape_sign,
      y = mean_angle,
      color = obj_shape_sign
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = NULL,
    y = NULL
  )

# add horizontal lines
p <- p +
  geom_hline(
    yintercept = c(0, 30), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "solid"
  ) +
  geom_hline(
    yintercept = c(15), linewidth = 0.4,
    colour = "#CCCCCC", linetype = "dashed"
  )

# add axis ticks
p <- p +
  scale_y_continuous(
    # limits = c(-15, 40),
    breaks = c(0, 15, 30),
    labels = c(0, 15, 30)
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(
      x = obj_shape_sign,
      y = ppt_mean_angle,
      color = obj_shape_sign
    ),
    size = 1,
    alpha = 0.1
  ) +
  geom_linerange(
    aes(
      ymin = mean_angle - ci_angle,
      ymax = mean_angle + ci_angle
    ),
    alpha = 0.5, lwd = 2
  ) +
  geom_point()

p <- p +
  scale_color_manual(
    values = c("#f07c04", "#a30f15")
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/dr_30_excl_clamped.pdf", device = "pdf",
    height = 4, width = 2
  )
}

p
```
```{r}
# Comparison stats
# paired t-test
group1 <- data_ppt %>% 
  filter(obj_shape_sign == "-1") %>% 
  pull(ppt_mean_angle)

group2 <- data_ppt %>%
  filter(obj_shape_sign == "1") %>% 
  pull(ppt_mean_angle)

diffs <- group2 - group1
t.test(diffs)

# Effect size
cohen.d(group1, group2)

# Bayes factor
ttestBF(x = diffs)
```

```{r}
trialset_paired <- 
  data_ppt %>%
  dabest(obj_shape_sign, ppt_mean_angle, 
         idx = c("-1", "1"), 
         paired = TRUE, id.col = ppid)

p <- trialset_paired %>% 
  mean_diff() %>% 
  plot()

p
```




# Plot slope and asymptote for both_ppt_training
```{r}

both_ppt_training$exp <- factor(both_ppt_training$exp)

both_exp_training <- both_ppt_training %>%
  group_by(exp) %>%
  summarise(
    mean_learning_rate = mean(ppt_learning_rate),
    ci_learning_rate = vector_confint(ppt_learning_rate),
    mean_asymptote = mean(ppt_asymptote),
    ci_asymptote = vector_confint(ppt_asymptote)
  )

data_ppt <- both_ppt_training
data_exp <- both_exp_training

# set up plot
p <- data_exp %>%
  ggplot(
    aes(
      x = exp,
      y = mean_learning_rate,
      color = exp
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = "Experiment",
    y = "Learning Rate"
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(
      x = exp,
      y = ppt_learning_rate,
      color = exp
    ),
    size = 1,
    alpha = 0.1
  ) +
  geom_linerange(
    aes(
      ymin = mean_learning_rate - ci_learning_rate,
      ymax = mean_learning_rate + ci_learning_rate
    ),
    alpha = 0.5, lwd = 2
  ) +
  geom_point()

p <- p +
  scale_color_manual(
    values = c("#f07c04", "#a30f15")
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/both_ppt_training_learning_rate.pdf", device = "pdf",
    height = 4, width = 2
  )
}

p
```
```{r}
both_ppt_training %>%
  group_by(exp) %>%
  summarise(
    mean = mean(ppt_learning_rate),
    sd = sd(ppt_learning_rate),
    ci = vector_confint(ppt_learning_rate),
    n = n()
  )
```

```{r}
temp_ANOVA <- aov(ppt_learning_rate ~ exp, data = both_ppt_training)

# show ANOVA + assumptions
print(summary(temp_ANOVA), digits = 6)
eta_squared(temp_ANOVA)
TukeyHSD(temp_ANOVA)
```
```{r}
bf <- anovaBF(ppt_learning_rate ~ exp, data = data.frame(both_ppt_training), progress = FALSE)
print(bf)
bayesfactor_inclusion(bf)
```

```{r}
# set up plot
p <- data_exp %>%
  ggplot(
    aes(
      x = exp,
      y = mean_asymptote,
      color = exp
    )
  ) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(
    x = "Experiment",
    y = "Asymptote"
  )

# set font size to 11
p <- p +
  theme(text = element_text(size = 11))

# add data points
p <- p +
  geom_beeswarm(
    data = data_ppt,
    aes(
      x = exp,
      y = ppt_asymptote,
      color = exp
    ),
    size = 1,
    alpha = 0.1
  ) +
  geom_linerange(
    aes(
      ymin = mean_asymptote - ci_asymptote,
      ymax = mean_asymptote + ci_asymptote
    ),
    alpha = 0.5, lwd = 2
  ) +
  geom_point()

p <- p +
  scale_color_manual(
    values = c("#f07c04", "#a30f15")
  )

# save
if (save_plots) {
  ggsave(
    p,
    filename = "../plots/paper_figs/both_ppt_training_asmptote.pdf", device = "pdf",
    height = 4, width = 2
  )
}

p
```
```{r}
both_ppt_training %>%
  group_by(exp) %>%
  summarise(
    mean = mean(ppt_asymptote),
    sd = sd(ppt_asymptote),
    ci = vector_confint(ppt_asymptote),
    n = n()
  )
```

```{r}
temp_ANOVA <- aov(ppt_asymptote ~ exp, data = both_ppt_training)

# show ANOVA + assumptions
print(summary(temp_ANOVA), digits = 6)
eta_squared(temp_ANOVA)
TukeyHSD(temp_ANOVA)
```
```{r}
bf <- anovaBF(ppt_asymptote ~ exp, data = data.frame(both_ppt_training), progress = FALSE)
print(bf)
bayesfactor_inclusion(bf)
```
```{r}
# empty
```

